<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextGear | Text to PDF</title>
</head>

<body>

    <div id="app-header"></div>

    <main class="main">
        <div class="header-area">
            <div class="page-info">
                <h1 data-i18n="tool_title">ØªØ­ÙˆÙŠÙ„ Ù†Øµ Ø¥Ù„Ù‰ PDF</h1>
                <p data-i18n="tool_desc">Ø­ÙˆÙ„ Ø£ÙŠ Ù†Øµ Ø¨Ø³ÙŠØ· Ø¥Ù„Ù‰ Ù…Ù„Ù PDF Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙˆØ±Ø§Ù‹.</p>
            </div>
        </div>

        <div class="tool-view active" style="display:block; max-width:800px; margin:0 auto">

            <div class="field">
                <label data-i18n="input_label">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù:</label>
                <textarea id="pdfContent" rows="10" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
            </div>

            <button class="run-btn" onclick="generatePDF()" id="genBtn" data-i18n="action_btn">Ø¥Ù†Ø´Ø§Ø¡ PDF</button>

            <div class="output-area" id="output" style="display:none">
                <div class="output-val" id="outputVal"></div>
            </div>

        </div>
    </main>

    <div id="app-footer"></div>

    <script src="../../global.js"></script>
    <!-- Load Worker Client -->
    <script src="../../js/worker-client.js"></script>

    <script>
        const pageDict = {
            'ar': { 'tool_title': 'ØªØ­ÙˆÙŠÙ„ Ù†Øµ Ø¥Ù„Ù‰ PDF', 'tool_desc': 'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª PDF Ø¨Ø³Ø±Ø¹Ø©.', 'input_label': 'Ø§Ù„Ù†Øµ', 'action_btn': 'Ø¥Ù†Ø´Ø§Ø¡ PDF', 'processing': 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...', 'success': 'âœ… ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡!' },
            'en': { 'tool_title': 'Text to PDF', 'tool_desc': 'Create PDF files quickly.', 'input_label': 'Text', 'action_btn': 'Generate PDF', 'processing': 'â³ Processing...', 'success': 'âœ… Created!' }
        };

        window.addEventListener('DOMContentLoaded', () => {
            const lang = window.NextGear.lang;
            const dict = pageDict[lang] || pageDict['en'];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (dict[key]) el.innerText = dict[key];
            });
        });

        async function generatePDF() {
            const txt = document.getElementById('pdfContent').value;
            if (!txt) return alert('Please enter text');

            const btn = document.getElementById('genBtn');
            const out = document.getElementById('output');
            const outVal = document.getElementById('outputVal');

            const lang = window.NextGear.lang;
            const dict = pageDict[lang] || pageDict['en'];

            btn.disabled = true;
            btn.innerText = dict['processing'];

            try {
                // Call the Shared Worker
                // Note: The worker returns bytes in 'result.result' or just 'result' depending on implementation
                // Looking at worker.js, it returns { result: pdfBytes, type: 'pdf' } for this tool.

                // We need to adjust WorkerClient to handle specific return types or just return raw data.
                // Current WorkerClient returns the raw .data object of the message? No, it returns .result of .data.
                // Let's check worker logic: self.postMessage({ result: pdfBytes, type: 'pdf' });
                // So WorkerClient receives {result, type}. But our simple client resolves 'result'.
                // We might need to update client or just handle it. 
                // Let's assume WorkerClient resolves EITHER the full object or just result. 
                // Actually my implementation of WorkerClient resolves e.data.result. 
                // This works for simple tools, but for PDF tool the worker sends { result: bytes, type: 'pdf' }.
                // So e.data is { result: bytes, type: 'pdf' }. e.data.result is the bytes. Perfect.

                const pdfBytes = await WorkerClient.run('txt2pdf', { txt: txt });

                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);

                out.style.display = 'block';
                outVal.innerHTML = `
                    <iframe src="${url}" style="width:100%;height:400px;border:none;border-radius:8px"></iframe>
                    <br>
                    <a href="${url}" download="document.pdf" class="pro-btn" style="display:inline-block;margin-top:10px">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ PDF</a>
                `;

                btn.innerText = dict['success'];

            } catch (err) {
                console.error(err);
                alert('Error: ' + err);
                btn.innerText = dict['action_btn'];
            }
            btn.disabled = false;
        }
    </script>
</body>

</html>