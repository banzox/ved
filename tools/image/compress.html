<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextGear | Image Compressor</title>
</head>

<body>

    <div id="app-header"></div>

    <main class="main">
        <div class="header-area">
            <div class="page-info">
                <h1 data-i18n="tool_title">Ø¶ØºØ· Ø§Ù„ØµÙˆØ±</h1>
                <p data-i18n="tool_desc">ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ¯Ø©.</p>
            </div>
        </div>

        <div class="tool-view active" style="display:block; max-width:800px; margin:0 auto">

            <div class="field">
                <label data-i18n="input_label">Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØ±Ø©:</label>
                <input type="file" id="imgInput" accept="image/*">
            </div>

            <div class="field">
                <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶ØºØ·:</label>
                <select id="quality">
                    <option value="0.8">Ø®ÙÙŠÙ (High Quality)</option>
                    <option value="0.6" selected>Ù…ØªÙˆØ³Ø· (Balanced)</option>
                    <option value="0.4">Ù‚ÙˆÙŠ (Low Size)</option>
                </select>
            </div>

            <button class="run-btn" onclick="runComp()" data-i18n="action_btn">Ø¶ØºØ· Ø§Ù„ØµÙˆØ±Ø©</button>

            <div class="output-area" id="output" style="display:none; text-align:center">
                <div id="outputVal"></div>
            </div>

        </div>
    </main>

    <div id="app-footer"></div>
    <script src="../../global.js"></script>

    <script>
        const pageDict = {
            'ar': { 'tool_title': 'Ø¶ØºØ· Ø§Ù„ØµÙˆØ±', 'tool_desc': 'ØµØºØ± Ø­Ø¬Ù… ØµÙˆØ±Ùƒ Ù„Ù„Ù…ÙˆØ§Ù‚Ø¹.', 'input_label': 'Ø§Ù„ØµÙˆØ±Ø©', 'action_btn': 'Ø¶ØºØ·' },
            'en': { 'tool_title': 'Image Compressor', 'tool_desc': 'Reduce image size.', 'input_label': 'Image', 'action_btn': 'Compress' }
        };

        window.addEventListener('DOMContentLoaded', () => {
            const lang = window.NextGear.lang;
            const dict = pageDict[lang] || pageDict['en'];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (dict[key]) el.innerText = dict[key];
            });
        });

        async function runComp() {
            const file = document.getElementById('imgInput').files[0];
            const q = parseFloat(document.getElementById('quality').value);

            if (!file) return alert('Select image');

            const resUrl = await window.processImage(file, (ctx, cvs, img) => {
                cvs.width = img.width;
                cvs.height = img.height;
                ctx.drawImage(img, 0, 0);
                return cvs.toDataURL('image/jpeg', q);
            });

            document.getElementById('output').style.display = 'block';
            document.getElementById('outputVal').innerHTML = `
                <img src="${resUrl}" style="max-width:100%; border-radius:10px">
                <br><br>
                <a href="${resUrl}" download="compressed.jpg" class="pro-btn">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ (JPEG)</a>
            `;
        }
    </script>
</body>

</html>